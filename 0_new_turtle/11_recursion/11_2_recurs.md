# Рекурсивный вызов функции

lesson = 530426

## Что такое рекурсия?

Нужно составить список кто пришел на урок.

### Вариант 1.

Список составляет 1 человек. Он пишет все имена на 1 листе бумаги.

### Вариант 2.

Студенты сидят так: Саша, Таня, Максим, Оля.

* Студент:
    * Пишет свое имя на листе.
    * Если есть ученик дальше, **отдает лист следующему студенту**
    * Ждет, когда вернется лист.
    * Возвращает лист    
    
* Учитель:
    * дает пустой лист первому ученику.
    * получает от него лист с именами.
    
Что делают:

| Учитель | Саша | Таня | Максим | Оля | На листе написано | 
|----|----|----|----|----|----|
| отдает лист Саше | | | | | _лист пустой_ |
| | Пишет `Саша` <br/> Отдает лист Тане | | | | Саша |
| | | Пишет `Таня` <br/> Отдает лист Максиму | | | Саша<br/>Таня |
| | | |Пишет `Максим` <br/> Отдает лист Оле | | Саша<br/>Таня<br/>Максим |
| | | | |Пишет `Оля` <br/> Отдавать некому | Саша<br/>Таня<br/>Максим<br/>Оля |
| | | | возвращает лист | | Саша<br/>Таня<br/>Максим<br/>Оля |
| | | возвращает лист | | | Саша<br/>Таня<br/>Максим<br/>Оля |
| | возвращает лист | | | | Саша<br/>Таня<br/>Максим<br/>Оля |
| возвращает лист | | | | | Саша<br/>Таня<br/>Максим<br/>Оля |

У учителя лист. На листе написано:
```cpp
Саша
Таня
Максим
Оля
```

Функция _учитель_ вызывает функцию _студент_ и получает от нее список.

Функция _студент_ вызывает функцию _студент_ (или не вызывает ничего). 

**Рекурсивный вызов функции** когда функция вызывает себя. 

Функция _студент_ вызывает функцию _студент_ (все студенты делают одно и то же). Но это разные экземпляры вызова функций. Это разные студенты, у них разные имена.

## Хвостовая рекурсия

* Студент:
    * Пишет свое имя на листе.  <-- _сначала  делаем_
    * Если есть ученик дальше, **отдает лист следующему студенту** <--- _потом вызываем следующего студента_
    * Ждет, когда вернется лист.
    * Возвращает лист    <--- _конец_

Если сначала делаем, потом вызываем такую же функцию и сразу конец, то это **хвостовая рекурсия**.

Из хвостовой рекурсии можно легко сделать цикл.

## Когда не хвостовая рекурсия?

Поменяем местами. Сначала будем отдавать лист другому студенту, потом писать на нем имя.

Студенты сидят так: Саша, Таня, Максим, Оля.

* Студент:
    * Если есть ученик дальше, **отдает лист следующему студенту**
    * Ждет, когда вернется лист.
    * **Пишет свое имя на листе.**
    * Возвращает лист    
    
* Учитель:
    * дает пустой лист первому ученику.
    * получает от него лист с именами.
    
Что делают:

| Учитель | Саша | Таня | Максим | Оля | На листе написано | 
|----|----|----|----|----|----|
| отдает лист Саше | | | | | _лист пустой_ |
| | Отдает лист Тане | | | | _лист пустой_ |
| | | Отдает лист Максиму | | | _лист пустой_ |
| | | | Отдает лист Оле | | _лист пустой_ |
| | | | | Отдавать некому | _лист пустой_ |
| | | | | Пишет `Оля` | Оля |
| | | | | возвращает лист | Оля |
| | | | пишет `Максим` | | Оля<br/>Максим |
| | | | возвращает лист | | Оля<br/>Максим |
| | | пишет `Таня` | | | Оля<br/>Максим<br/>Таня |
| | | возвращает лист | | | Оля<br/>Максим<br/>Таня |
| | пишет `Саша` | | | | Оля<br/>Максим<br/>Таня<br/>Саша |
| | возвращает лист | | | | Оля<br/>Максим<br/>Таня<br/>Саша |
| возвращает лист | | | | |  Оля<br/>Максим<br/>Таня<br/>Саша |

У учителя лист. На листе написано:
```cpp
Оля
Максим
Таня
Саша
```

Список в обратном порядке.


## n квадратов с циклом

Функция **sqn(size, d, n)** рисует квадраты

* **size** - размер первого квадрата
* Каждый следующий квадрат на **d** меньше.
* **n** - осталось нарисовать n квадратов.

```python
# n квадратов, первый размера size, каждый следующий на d меньше
def sqn(size, d, n):    
  for i in range(n):    # i меняется от 0 до n-1
    sq(size, colors[i]) # colors[i] - взять цвет номер i из colors
    size -= d
    if size < 0:        # если следующий квадрат маленький, больше не рисовать
      return
```

![квадраты](https://stepik.org/media/attachments/lesson/479603/ex11_1.png)

Вся программа:
```python
import turtle           

colors = [
  'violet',   # colors[0]
  'blue',     # colors[1]
  'green',    # colors[2]
  'yellow',   # colors[3]
  'gold',     # colors[4]
  'orange',   # colors[5]
  'red'       # colors[6]
  ]

def sq(size, col):  # нарисовать квадрат размера size цвета col
  t.color(col)
  for i in range(4):
    t.fd(size)
    t.left(90)

# n квадратов, первый размера size, каждый следующий на d меньше
def sqn(size, d, n):    
  for i in range(n):    # i меняется от 0 до n-1
    sq(size, colors[i]) # colors[i] - взять цвет номер i из colors
    size -= d
    if size < 0:        # если следующий квадрат маленький, больше не рисовать
      return
    
t = turtle.Turtle()
t.shape("turtle")
t.width(3)
t.speed(0)

# sqn(200, 20, 7)   # 7 квадратов, первый размером 200, другие на 20 меньше
sqn(100, 20, 7)   # 5 квадратов, первый размером 100, другие на 20 меньше

turtle.done()    
```

## Как нарисовать n квадратов без цикла?

Функция **sqn(size, d, n, i)** рисует квадраты

* **size** - размер первого квадрата
* Каждый следующий квадрат на **d** меньше.
* **n** - осталось нарисовать n квадратов.
* **i** - уже нарисовали i квадратов (по i получаем цвет квадрата).

Изменится только эта функция. Остальной код не изменится.

В функции sqn вызовем sqn еще раз. Это называется рекурсивным вызовом функции или рекурсией.

```python
def sqn(size, d, n, i):
  if n == 0:        # не надо рисовать?
    return          # не рисовать!
  if size <= 0:     # маленький квадрат?
    return          # не рисовать!
    
  # рисовать 1 квадрат, цвет из i
  col = get_color(i) 
  sq(size, col)
  
  # рисовать остальные квадраты
  sqn(size-d, d, n-1, i+1)             # вызвали саму себя 
  # следующий квадрат размера size-d
  # осталось нарисовать n-1 квадрат (1 нарисовали тут)
  # уже нарисовали i+1 квадрат (1 нарисовали тут)
  
  # функция закончилась
```

Вызов функции
```python
sqn(200, 20, 7, 0)   
# 7 квадратов, первый размером 200, другие на 20 меньше
# уже нарисовали 0 квадратов
```

![квадраты](https://stepik.org/media/attachments/lesson/479603/ex11_1.png)

Вся программа:
```python
import turtle           

colors = [
  'violet',   # colors[0]
  'blue',     # colors[1]
  'green',    # colors[2]
  'yellow',   # colors[3]
  'gold',     # colors[4]
  'orange',   # colors[5]
  'red'       # colors[6]
  ]

def sq(size, col):  # нарисовать квадрат размера size цвета col
  t.color(col)
  for i in range(4):
    t.fd(size)
    t.left(90)

# возвращает цвет по номеру i из списка colors
def get_color(i):
	return colors[i % len(colors)]

# n квадратов, 
# этот размера size, 
# следующий на d меньше
# уже нарисовали i квадратов
def sqn(size, d, n, i):
  if n == 0:        # не надо рисовать?
    return          # не рисовать!
  if size <= 0:     # маленький квадрат?
    return          # не рисовать!
    
  # рисовать 1 квадрат, цвет из i
  col = get_color(i) 
  sq(size, col)
  
  # рисовать остальные квадраты
  sqn(size-d, d, n-1, i+1)
  # следующий квадрат размера size-d
  # осталось нарисовать n-1 квадрат (1 нарисовали тут)
  # уже нарисовали i+1 квадрат (1 нарисовали тут)
    
t = turtle.Turtle()
t.shape("turtle")
t.width(3)
t.speed(0)

sqn(200, 20, 7, 0)   
# 7 квадратов, первый размером 200, другие на 20 меньше
# уже нарисовали 0 квадратов

turtle.done()
```

## Сначала - условие выхода

Проверьте, как будет работать такая функция

```python
def sqn_endless(size, d, n, i):
  # рисовать 1 квадрат, цвет из i
  col = get_color(i) 
  sq(size, col)
  
  # рисовать остальные квадраты
  sqn(size-d, d, n-1, i+1)             # вызвали саму себя 

  # потом проверим
  if n == 0:        # не надо рисовать?
    return          # не рисовать!
  if size <= 0:     # маленький квадрат?
    return          # не рисовать!
```
Почему эта функция работает неправильно?

## Кто первый - один или остальные?

В функции sqn можно написать 

```python
sq(size, get_color(i))    # сначала этот 1 квадрат        
sqn(size-d, d, n-1, i+1)  # потом остальные квадраты
```
или так:
```python
sqn(size-d, d, n-1, i+1)  # сначала остальные квадраты
sq(size, get_color(i))    # потом этот 1 квадрат        
```
![квадраты](https://stepik.org/media/attachments/lesson/479603/order.png)

Квадраты рисуем от маленького к большому. Наоборот. Как список студентов в обратном порядке.

